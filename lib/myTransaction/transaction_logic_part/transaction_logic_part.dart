import 'dart:convert';

import 'package:flutter/cupertino.dart';
import 'package:longa_lotto/myTransaction/model/response/transaction_response.dart';
import 'package:longa_lotto/myTransaction/transaction_repository/transaction_repository.dart';
import 'package:longa_lotto/utility/result.dart';

class TransactionLogic {
    static Future<Result<dynamic>> callTransactionApi(BuildContext context, Map<String, dynamic> request) async {

      dynamic jsonMap = await TransactionRepository.callTransactionDetailApi(context, request);
      //jsonMap = jsonDecode('{"errorCode":0,"txnList":[{"transactionId":1882045,"transactionDate":"2023-01-05 12:07:11.0","particular":"Referred Player Bonus","txnType":"PLR_BONUS_TRANSFER","currencyId":14,"creditAmount":50.0,"txnAmount":50.0,"balance":1211.49,"openingBalance":1161.49,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1211.49},{"transactionId":1881353,"transactionDate":"2023-01-05 00:53:57.0","particular":"NE1StimeloginCASH","txnType":"PLR_BONUS_TRANSFER","currencyId":14,"creditAmount":100.0,"txnAmount":100.0,"balance":1161.49,"openingBalance":1061.49,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1161.49},{"transactionId":1880402,"transactionDate":"2023-01-04 03:58:21.0","particular":"NE1StimeloginCASH","txnType":"PLR_BONUS_TRANSFER","currencyId":14,"creditAmount":100.0,"txnAmount":100.0,"balance":1061.49,"openingBalance":961.49,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1061.49},{"transactionId":1880321,"transactionDate":"2023-01-03 11:21:58.0","particular":"WINNING-PowerBingo75-14","txnType":"PLR_WINNING","currencyId":14,"creditAmount":0.21,"txnAmount":0.21,"balance":961.49,"openingBalance":961.28,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":961.49,"gameGroup":"DRAW_GAMES"},{"transactionId":1880289,"transactionDate":"2023-01-03 11:11:32.0","particular":"WAGER-BingoNinety1-13","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":961.28,"openingBalance":971.28,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":961.28,"gameGroup":"DRAW_GAMES"},{"transactionId":1880278,"transactionDate":"2023-01-03 11:05:37.0","particular":"WAGER-BingoNinety1-13","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":971.28,"openingBalance":981.28,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":971.28,"gameGroup":"DRAW_GAMES"},{"transactionId":1880277,"transactionDate":"2023-01-03 11:02:59.0","particular":"WAGER-PowerBingo75-14","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":981.28,"openingBalance":991.28,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":981.28,"gameGroup":"DRAW_GAMES"},{"transactionId":1880276,"transactionDate":"2023-01-03 11:01:39.0","particular":"WAGER-PowerBingo75-14","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":991.28,"openingBalance":1001.28,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":991.28,"gameGroup":"DRAW_GAMES"},{"transactionId":1880273,"transactionDate":"2023-01-03 10:56:58.0","particular":"WINNING-PowerBingo90-15","txnType":"PLR_WINNING","currencyId":14,"creditAmount":0.28,"txnAmount":0.28,"balance":1001.28,"openingBalance":1001.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1001.28,"gameGroup":"DRAW_GAMES"},{"transactionId":1880261,"transactionDate":"2023-01-03 10:36:24.0","particular":"WAGER-BingoNinety-11","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":1001.0,"openingBalance":1011.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1001.0,"gameGroup":"DRAW_GAMES"},{"transactionId":1880257,"transactionDate":"2023-01-03 10:25:06.0","particular":"WAGER-PowerBingo90-15","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":1011.0,"openingBalance":1021.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1011.0,"gameGroup":"DRAW_GAMES"},{"transactionId":1880237,"transactionDate":"2023-01-03 10:09:14.0","particular":"WAGER-BingoNinety1-13","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":1021.0,"openingBalance":1031.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1021.0,"gameGroup":"DRAW_GAMES"},{"transactionId":1880222,"transactionDate":"2023-01-03 10:05:17.0","particular":"WAGER-BingoNinety-11","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":1031.0,"openingBalance":1041.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1031.0,"gameGroup":"DRAW_GAMES"},{"transactionId":1880219,"transactionDate":"2023-01-03 10:01:40.0","particular":"WAGER-BingoNinety-11","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":1041.0,"openingBalance":1051.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1041.0,"gameGroup":"DRAW_GAMES"},{"transactionId":1880046,"transactionDate":"2023-01-03 06:22:38.0","particular":"WAGER-BingoNinety1-13","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":1051.0,"openingBalance":1061.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1051.0,"gameGroup":"DRAW_GAMES"},{"transactionId":1880045,"transactionDate":"2023-01-03 06:21:26.0","particular":"WAGER-PowerBingo90-15","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":1061.0,"openingBalance":1071.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1061.0,"gameGroup":"DRAW_GAMES"},{"transactionId":1880042,"transactionDate":"2023-01-03 06:17:53.0","particular":"WAGER-BingoNinety1-13","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":1071.0,"openingBalance":1081.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1071.0,"gameGroup":"DRAW_GAMES"},{"transactionId":1880041,"transactionDate":"2023-01-03 06:17:20.0","particular":"WAGER-BingoNinety1-13","txnType":"PLR_WAGER","currencyId":14,"debitAmount":10.0,"txnAmount":10.0,"balance":1081.0,"openingBalance":1091.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1081.0,"gameGroup":"DRAW_GAMES"},{"transactionId":1879914,"transactionDate":"2023-01-03 01:43:13.0","particular":"NE1StimeloginCASH","txnType":"PLR_BONUS_TRANSFER","currencyId":14,"creditAmount":100.0,"txnAmount":100.0,"balance":1091.0,"openingBalance":991.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":1091.0},{"transactionId":1879871,"transactionDate":"2023-01-02 11:58:50.0","particular":"Winning_INSTANT SCRATCH_Cross n Zero_386216726603139091582","txnType":"PLR_WINNING","currencyId":14,"creditAmount":1.0,"txnAmount":1.0,"balance":991.0,"openingBalance":990.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":991.0,"gameGroup":"CASINO"},{"transactionId":1879870,"transactionDate":"2023-01-02 11:58:50.0","particular":"Wager_INSTANT SCRATCH_Spin 2 Win_831116726607300141582","txnType":"PLR_WAGER","currencyId":14,"debitAmount":1.0,"txnAmount":1.0,"balance":990.0,"openingBalance":991.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":990.0,"gameGroup":"CASINO"},{"transactionId":1879858,"transactionDate":"2023-01-02 11:51:54.0","particular":"Wager_INSTANT SCRATCH_Cross n Zero_386216726603139091582","txnType":"PLR_WAGER","currencyId":14,"debitAmount":1.0,"txnAmount":1.0,"balance":991.0,"openingBalance":992.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":991.0,"gameGroup":"CASINO"},{"transactionId":1879783,"transactionDate":"2023-01-02 09:31:01.0","particular":"Wager_INSTANT SCRATCH_Super Soccer_471316726518608071582","txnType":"PLR_WAGER","currencyId":14,"debitAmount":1.0,"txnAmount":1.0,"balance":992.0,"openingBalance":993.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":992.0,"gameGroup":"CASINO"},{"transactionId":1879782,"transactionDate":"2023-01-02 09:28:23.0","particular":"Wager_INSTANT SCRATCH_Super Soccer_859116726517028301582","txnType":"PLR_WAGER","currencyId":14,"debitAmount":1.0,"txnAmount":1.0,"balance":993.0,"openingBalance":994.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":993.0,"gameGroup":"CASINO"},{"transactionId":1879781,"transactionDate":"2023-01-02 09:28:04.0","particular":"Winning_INSTANT SCRATCH_Super Soccer_978716726516792801582","txnType":"PLR_WINNING","currencyId":14,"creditAmount":1.0,"txnAmount":1.0,"balance":994.0,"openingBalance":993.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":994.0,"gameGroup":"CASINO"},{"transactionId":1879780,"transactionDate":"2023-01-02 09:27:59.0","particular":"Wager_INSTANT SCRATCH_Super Soccer_978716726516792801582","txnType":"PLR_WAGER","currencyId":14,"debitAmount":1.0,"txnAmount":1.0,"balance":993.0,"openingBalance":994.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":993.0,"gameGroup":"CASINO"},{"transactionId":1879779,"transactionDate":"2023-01-02 09:27:53.0","particular":"Wager_INSTANT SCRATCH_Super Soccer_962116726516732841582","txnType":"PLR_WAGER","currencyId":14,"debitAmount":1.0,"txnAmount":1.0,"balance":994.0,"openingBalance":995.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":994.0,"gameGroup":"CASINO"},{"transactionId":1879778,"transactionDate":"2023-01-02 09:27:31.0","particular":"Wager_INSTANT SCRATCH_Cross n Zero_114216726516513171582","txnType":"PLR_WAGER","currencyId":14,"debitAmount":1.0,"txnAmount":1.0,"balance":995.0,"openingBalance":996.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":995.0,"gameGroup":"CASINO"},{"transactionId":1879777,"transactionDate":"2023-01-02 09:27:25.0","particular":"Wager_INSTANT SCRATCH_Cross n Zero_126416726516446741582","txnType":"PLR_WAGER","currencyId":14,"debitAmount":1.0,"txnAmount":1.0,"balance":996.0,"openingBalance":997.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":996.0,"gameGroup":"CASINO"},{"transactionId":1879776,"transactionDate":"2023-01-02 09:26:56.0","particular":"Wager_INSTANT SCRATCH_777 Casino_621016726516160801582","txnType":"PLR_WAGER","currencyId":14,"debitAmount":1.0,"txnAmount":1.0,"balance":997.0,"openingBalance":998.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":997.0,"gameGroup":"CASINO"},{"transactionId":1879775,"transactionDate":"2023-01-02 09:26:49.0","particular":"Wager_INSTANT SCRATCH_777 Casino_648916726516085161582","txnType":"PLR_WAGER","currencyId":14,"debitAmount":1.0,"txnAmount":1.0,"balance":998.0,"openingBalance":999.0,"subwalletTxn":"NO","currency":"BTC","withdrawableBalance":998.0,"gameGroup":"CASINO"}]}');

      try {
      var respObj = TransactionResponse.fromJson(jsonMap);
      if (respObj.errorCode == 0) {
        return Result.responseSuccess(data: respObj);

      } else {
        return jsonMap["occurredErrorDescriptionMsg"] != null ? jsonMap["occurredErrorDescriptionMsg"] == "No connection" ? Result.networkFault(data: jsonMap) : Result.failure(data: jsonMap) : Result.responseFailure(data: respObj);
      }

    } catch(e) {
      if(jsonMap["occurredErrorDescriptionMsg"] == "No connection") {
        return Result.networkFault(data: jsonMap);

      } else {
        return Result.failure(data: jsonMap["occurredErrorDescriptionMsg"] != null ? jsonMap : {"occurredErrorDescriptionMsg": e});
      }
    }

  }
}